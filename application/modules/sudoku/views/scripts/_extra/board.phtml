<?php
$cols = 9; // 1..9
$rows = 9;

/** @var Application_Model_Game_Sudoku $sudoku */
$sudoku = $this->sudoku;
$game = $sudoku->getParams();

/**
 * @param int $row
 * @param int $col
 * @return bool
 */
function isGray($row, $col) {
    $grayRow = (bool)(ceil($row / 3) % 2); // 111000111
    $grayCol = (bool)(ceil($col / 3) % 2); // 111000111
    $isGray = $grayRow == $grayCol;
    return $isGray;
}
?>
<div class="sudoku-table" ondragstart="return false;" ondrop="return false;" data-selected-cell="" data-hovered-number="">

    <div class="game-params">
        Cells opened initially: <span><?php echo count($game['openCells']);?></span>
    </div>

    <div class="congratulations">
        <div class="message">
            Congratulations!<br>
            You have solved this sudoku!
        </div>
    </div>

    <table class="sudoku-board">
        <?php for ($r = 1; $r <= $rows; $r++): ?>
        <tr>
            <?php for ($c = 1; $c <= $cols; $c++): ?>
                <?php
                    $isGray = isGray($r, $c);
                    $cellNumber = $r . $c;
                    $number = isset($game['openCells'][$cellNumber]) ? $game['openCells'][$cellNumber] : '';
                ?>
                <td
                    class="cell row-<?php echo $r; ?> col-<?php echo $c; ?> <?php if ($isGray) echo 'gray'; ?> <?php echo $number ? 'locked' : 'open empty'; ?>"
                    data-row="<?php echo $r; ?>"
                    data-col="<?php echo $c; ?>"
                    data-number="<?php echo $number; ?>"
                >
                    <?php echo $number; ?>
                </td>
            <?php endfor; ?>
        </tr>
        <?php endfor; ?>
    </table>

    <div class="sudoku-numpad">
        <table>
            <?php /*
            <tr>
                <td colspan="3" class="close"><i class="icon-remove-circle"></i></td>
            </tr>
            */ ?>
            <?php $number = 1; ?>
            <?php for ($r = 1; $r <= 3; $r++): ?>
            <tr>
                <?php for ($c = 1; $c <= 3; $c++): ?>
                    <td class="number enabled" data-number="<?php echo $number; ?>">
                        <?php if ($number == 3): ?><?php endif; ?>
                        <?php echo $number; ?>
                    </td>
                    <?php $number++; ?>
                <?php endfor; ?>
            </tr>
            <?php endfor; ?>
            <tr>
                <td class="number clear" colspan="3" data-number="">clear</td>
            </tr>
        </table>
    </div>

    <div class="additional-buttons">
        <button class="undo-move btn btn-mini disabled" data-moves=""><i class="icon-chevron-left"></i> Undo</button>
        <button class="redo-move btn btn-mini disabled" data-moves=""><i class="icon-chevron-right"></i>Redo</button>
        <button class="check-field btn btn-mini">Check</button>
        <button class="clear-field btn btn-mini btn-danger">Clear</button>
    </div>
</div>

<?php $this->headScript()->appendScript('var $game = new window.Sudoku(\'.sudoku-table\');'); ?>
